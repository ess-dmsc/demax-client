<section *ngIf="proposals.length === 0">
	There are no proposals in the database. Create a new proposal below.
</section>
<section *ngIf="!isEditing && proposals.length !=0" class="proposal-list">
	<table mat-table [dataSource]="proposals" class="mat-elevation-z8">

		<ng-container matColumnDef="proposalId">
			<th mat-header-cell *matHeaderCellDef> Proposal ID</th>
			<td mat-cell *matCellDef="let proposal"> {{proposal.proposalId}}</td>
		</ng-container>

		<ng-container matColumnDef="experimentTitle">
			<th mat-header-cell *matHeaderCellDef> Experiment title</th>
			<td mat-cell *matCellDef="let proposal"> {{proposal.experimentTitle}}</td>
		</ng-container>

		<ng-container matColumnDef="lab">
			<th mat-header-cell *matHeaderCellDef> Lab</th>
			<td mat-cell *matCellDef="let proposal"> {{proposal.lab}}</td>
		</ng-container>

		<ng-container matColumnDef="options">
			<th mat-header-cell *matHeaderCellDef> Options</th>
			<td mat-cell *matCellDef="let proposal">
				<button mat-flat-button color="primary" (click)="enableEditing(proposal)">Edit</button>
				<button mat-flat-button color="warn" (click)="deleteProposal(proposal)">Delete</button>
			</td>
		</ng-container>
		<ng-container matColumnDef="pdf">
			<th mat-header-cell *matHeaderCellDef>Download PDF</th>
			<td mat-cell *matCellDef="let proposal">
				<a href="/api/pdf/{{proposal.proposalId}}">
					<button mat-stroked-button class="btn btn-success">
						<mat-icon>get_app</mat-icon>
						Download
					</button>
				</a>
			</td>
		</ng-container>

		<tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
		<tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
	</table>
</section>
<button mat-raised-button color="primary" *ngIf="!isEditing" (click)="addProposal()">
	<mat-icon>add</mat-icon>
	Create new proposal
</button>

<section *ngIf="isEditing" class="editProposal">
	<form (ngSubmit)="editProposal(proposal)">
		<mat-tab-group [(selectedIndex)]="selectedIndex">

			<mat-tab label="1. General information">
				<mat-card>

					<h3>
						Proposal ID: {{proposal.proposalId}}
					</h3>

					<mat-form-field>
						<input matInput
						       name="proposal.experimentTitle"
						       [(ngModel)]="proposal.experimentTitle"
						       placeholder="Experiment title">
					</mat-form-field>
					<mat-form-field>
					<textarea matInput
					          name="proposal.briefSummary"
					          [(ngModel)]="proposal.briefSummary"
					          placeholder="Brief summary"
					          rows="4" cols="40"></textarea>
					</mat-form-field>


					<h4>Main proposer</h4>

					<mat-form-field class="smallFormField">
						<input matInput
						       name="proposal.mainProposer.firstName"
						       [(ngModel)]="proposal.mainProposer.firstName"
						       placeholder="First name">
					</mat-form-field>
					<mat-form-field class="smallFormField">
						<input matInput
						       name="proposal.mainProposer.lastName"
						       [(ngModel)]="proposal.mainProposer.lastName"
						       placeholder="Last name">
					</mat-form-field>
					<br>
					<mat-form-field class="smallFormField">
						<input matInput
						       name="proposal.mainProposer.phone"
						       [(ngModel)]="proposal.mainProposer.phone"
						       placeholder="phone">
					</mat-form-field>
					<mat-form-field class="smallFormField">
						<input matInput
						       name="proposal.mainProposer.email"
						       [(ngModel)]="proposal.mainProposer.email"
						       placeholder="email">
					</mat-form-field>

					<p>Affiliation</p>

					<mat-form-field class="smallFormField">
						<input matInput
						       name="proposal.mainProposer.sector"
						       [(ngModel)]="proposal.mainProposer.sector"
						       placeholder="Industry">
					</mat-form-field>
					<mat-form-field class="smallFormField">
						<input matInput
						       name="proposal.mainProposer.employer"
						       [(ngModel)]="proposal.mainProposer.employer"
						       placeholder="Employer">
					</mat-form-field>
					<mat-form-field class="smallFormField">
						<input matInput
						       name="proposal.mainProposer.title"
						       [(ngModel)]="proposal.mainProposer.title"
						       placeholder="Job title">
					</mat-form-field>

					<h4>Co-proposers</h4>

					<mat-form-field class="smallFormField">
						<input matInput
						       name="proposal.coProposers.coProposer.firstName"
						       [(ngModel)]="proposal.coProposers.firstName"
						       placeholder="First name">
					</mat-form-field>
					<mat-form-field class="smallFormField">
						<input matInput
						       name="proposal.coProposers.lastName"
						       [(ngModel)]="proposal.coProposers.lastName"
						       placeholder="Last name">
					</mat-form-field>
					<mat-form-field class="smallFormField">
						<input matInput
						       name="proposal.coProposers.affiliation"
						       [(ngModel)]="proposal.coProposers.affiliation"
						       placeholder="Affiliation">
					</mat-form-field>
					<button mat-icon-button class="success">Add co-proposer
						<mat-icon>add</mat-icon>
					</button>

					<mat-radio-group name="proposal.linksWithIndustry"
					                 [(ngModel)]="proposal.linksWithIndustry">
						<p>Links with industry?</p>
						<mat-radio-button value="yes">Yes</mat-radio-button>
						<mat-radio-button value="no">No</mat-radio-button>
					</mat-radio-group>
					<mat-radio-group name="proposal.coProposerStudents" [(ngModel)]="proposal.coProposerStudents">
						<p>Are any of the co-proposers students?</p>
						<mat-radio-button value="yes">Yes</mat-radio-button>
						<mat-radio-button value="no">No</mat-radio-button>
					</mat-radio-group>
					<mat-radio-group name="proposal.workTowardsStudentsDegree"
					                 [(ngModel)]="proposal.workTowardsStudentsDegree">
						<p>Does the proposal work towards a students degree?</p>
						<mat-radio-button value="yes">Yes</mat-radio-button>
						<mat-radio-button value="no">No</mat-radio-button>
					</mat-radio-group>

					<h4>Final delivery date</h4>
					<mat-form-field>
						<input matInput
						       name="proposal.needByDate"
						       [(ngModel)]="proposal.needByDate"
						       [matDatepicker]="picker"
						       placeholder="Choose a date">
						<mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
						<mat-datepicker #picker></mat-datepicker>
					</mat-form-field>
					<mat-form-field>
						<p>Please motivate the chosen date<br><em>
							<small>(e.g. based on awarded beamtime, or described intention to apply)</small>
						</em></p>
						<textarea matInput
						          name="needByDateMotivation"
						          [(ngModel)]="proposal.needByDateMotivation"
						          rows="4" cols="40"></textarea>
					</mat-form-field>
					<p>Attach a copy of the beamtime proposal, draft or intended submission:<br><strong
							style="color: red;">Accepted formats: PDF</strong></p>
					<label class="btn btn-default">
						<input name="needByDateAttachment"
						       style="width: 100%;"
						       type="file"
						       (change)="selectFile($event)">
					</label>
					<mat-form-field>
						<p>If there is anything else you would like us to know, please enter it below:</p>
						<textarea matInput
						          name="proposal.other"
						          [(ngModel)]="proposal.other"
						          rows="4" cols="40"></textarea>
					</mat-form-field>
					<p>In the next sections you will fill out the applicable area of support your proposal requires.<br>Select
						one, or as many as apply, from the alternatives below.</p>

					<mat-checkbox [(ngModel)]="proposal.wantsCrystallization" name="proposal.wantsCrystallization">
						Crystallization
					</mat-checkbox>
					<mat-checkbox [(ngModel)]="proposal.wantsBiologicalDeuteration"
					              name="proposal.wantsBiologicalDeuteration">Biological deuteration
					</mat-checkbox>
					<mat-checkbox [(ngModel)]="proposal.wantsChemicalDeuteration"
					              name="proposal.wantsChemicalDeuteration">Chemical deuteration
					</mat-checkbox>

					<mat-action-row>
						<button mat-button class="btn btn-danger" (click)="cancelEditing()">Cancel</button>
						<button mat-button class="btn btn-primary" (click)="selectTab(1)">Next</button>
						<button mat-raised-button color="primary" type="submit">Save</button>
					</mat-action-row>
				</mat-card>
			</mat-tab>
			<mat-tab label="2. Crystallization" [disabled]="!proposal.wantsCrystallization">
				<mat-card>

					<p>Required information to include in the “Practical Considerations” section of your proposal:</p>
					<ul>
						<li>SDS-PAGE</li>
						<li>Chromatogram of protein purification to indicate yield & purity</li>
						<li>Photo of crystal</li>
					</ul>

					<mat-form-field>
						<p>Name of molecule to be crystallized:<br><em>
							<small>(e.g. superoxide dismutase)</small>
						</em></p>
						<input matInput
						       name="crystallization.moleculeName"
						       [(ngModel)]="proposal.crystallization.moleculeName"
						       [disabled]="!proposal.wantsCrystallization">
					</mat-form-field>
					<mat-form-field>
						<p>FASTA sequence or Uniprot number:</p>
						<input matInput
						       name="crystallization.moleculeIdentifier"
						       [(ngModel)]="proposal.crystallization.moleculeIdentifier"
						       [disabled]="!proposal.wantsCrystallization">
					</mat-form-field>
					<mat-form-field>
						<p>Molecular weight
							<small>(kDA)</small>
							:
						</p>
						<input matInput
						       name="crystallization.molecularWeight"
						       [(ngModel)]="proposal.crystallization.molecularWeight"
						       [disabled]="!proposal.wantsCrystallization">
					</mat-form-field>
					<mat-form-field>
						<p>Oligomerization state:<br><em>
							<small>(e.g. homodimer, tetramer etc.)</small>
						</em></p>
						<input matInput
						       name="crystallization.oligomerizationState"
						       [(ngModel)]="proposal.crystallization.oligomerizationState"
						       [disabled]="!proposal.wantsCrystallization">
					</mat-form-field>
					<mat-form-field>
						<p>PDB ID of crystal structure:</p>
						<input matInput
						       name="crystallization.pbdId"
						       [(ngModel)]="proposal.crystallization.pbdId"
						       [disabled]="!proposal.wantsCrystallization">
					</mat-form-field>
					<mat-form-field>
						<p>If the reference is publicly available, please provide the DOI or an accessible link:</p>
						<input matInput
						       name="crystallization.doi"
						       [(ngModel)]="proposal.crystallization.doi"
						       [disabled]="!proposal.wantsCrystallization">
					</mat-form-field>
					<p>If the reference isn't publicly available, please upload a copy:<br><strong style="color: red;">Accepted
						formats: PDF</strong></p>
					<label class="btn btn-default">
						<input name="pbdIdReferenceAttachment"
						       [disabled]="!proposal.wantsCrystallization"
						       style="width: 100%;"
						       type="file"
						       (change)="selectFile($event)">
					</label>
					<mat-form-field>
						<p>Does the protein have any co-factors or ligands required for crystallization? Specify:</p>
						<textarea matInput
						          name="crystallization.crystallizationRequirements"
						          [(ngModel)]="proposal.crystallization.crystallizationRequirements"
						          [disabled]="!proposal.wantsCrystallization"
						          rows="4" cols="40"></textarea>
					</mat-form-field>
					<mat-form-field>
						<p>Known crystallization precipitant composition:<br><em>
							<small>(incl. buffer, salt, additives, pH)</small>
						</em></p>
						<textarea matInput
						          name="crystallization.crystallizationPrecipitantComposition"
						          [(ngModel)]="proposal.crystallization.crystallizationPrecipitantComposition"
						          [disabled]="!proposal.wantsCrystallization"
						          rows="4" cols="40"></textarea>
					</mat-form-field>
					<mat-form-field>
						<p>What crystallization method, volume, and temperature have you used in the past?<br><em>
							<small>(e.g. vapour diffusion, 10 &#181;L drops, room temperature)</small>
						</em></p>
						<textarea matInput
						          name="crystallization.previousCrystallizationExperience"
						          [(ngModel)]="proposal.crystallization.previousCrystallizationExperience"
						          [disabled]="!proposal.wantsCrystallization"
						          rows="4" cols="60"></textarea>
					</mat-form-field>
					<mat-form-field>
						<p>How long do your crystals take to appear?</p>
						<input matInput
						       name="crystallization.estimatedCrystallizationProductionTime"
						       [(ngModel)]="proposal.crystallization.estimatedCrystallizationProductionTime"
						       [disabled]="!proposal.wantsCrystallization">
					</mat-form-field>
					<mat-form-field>
						<p>What is the typical size of your crystal?<br><em>
							<small>( &#181;m x &#181;m x &#181;m )</small>
						</em></p>
						<input matInput
						       name="crystallization.typicalCrystalSize"
						       [(ngModel)]="proposal.crystallization.typicalCrystalSize"
						       [disabled]="!proposal.wantsCrystallization">
					</mat-form-field>

					<br>

					<h4>Details from protein preparation</h4>

					<mat-form-field>
						<p>Typical yield:<br><em>
							<small>(mg per liter of culture)</small>
						</em></p>
						<input matInput
						       name="crystallization.typicalYieldMgPerLiter"
						       [(ngModel)]="proposal.crystallization.typicalYieldMgPerLiter"
						       [disabled]="!proposal.wantsCrystallization">
					</mat-form-field>
					<mat-form-field>
						<p>Storage conditions:<br><em>
							<small>(e.g. stable at 4 &#176;C or frozen at -20 &#176;C)</small>
						</em></p>
						<input matInput
						       name="crystallization.storageConditions"
						       [(ngModel)]="proposal.crystallization.storageConditions"
						       [disabled]="!proposal.wantsCrystallization">
					</mat-form-field>
					<mat-form-field>
						<p>Stability:</p>
						<input matInput
						       name="crystallization.stability"
						       [disabled]="!proposal.wantsCrystallization"
						       [(ngModel)]="proposal.crystallization.stability">
					</mat-form-field>
					<mat-form-field>
						<p>What buffer is your protein in?</p>
						<input matInput
						       name="crystallization.buffer"
						       [(ngModel)]="proposal.crystallization.buffer"
						       [disabled]="!proposal.wantsCrystallization">
					</mat-form-field>
					<mat-form-field>
						<p>Is your protein partially or fully deuterated?</p>
						<input matInput
						       name="crystallization.levelOfDeuteration"
						       [(ngModel)]="proposal.crystallization.levelOfDeuteration"
						       [disabled]="!proposal.wantsCrystallization">
					</mat-form-field>
					<mat-form-field>
						<p>What protein concentration do you usually use for crystallization?</p>
						<input matInput
						       name="crystallization.typicalProteinConcentrationUsed"
						       [(ngModel)]="proposal.crystallization.typicalProteinConcentrationUsed"
						       [disabled]="!proposal.wantsCrystallization">
					</mat-form-field>

					<mat-action-row>
						<button mat-button class="btn btn-danger" (click)="selectTab(2)">Skip</button>
						<button mat-button class="btn btn-danger" (click)="selectTab(0)">Back</button>
						<button mat-button class="btn btn-primary" (click)="selectTab(2)">Next</button>
						<button mat-raised-button color="primary" type="submit">Save</button>
					</mat-action-row>

				</mat-card>
			</mat-tab>

			<mat-tab label="3. Biological deuteration" [disabled]="!proposal.wantsBiologicalDeuteration">
				<mat-card>

					<p>If the protein is to be purified by us, please remember to include a chromatogram from
						purification and a picture of SDS-PAGE that indicates MW and purity in your science case.</p>

					<p>Select one, or as many as apply, from the alternatives below.</p>

					<mat-checkbox name="proposal.wantsBiomassDeuteration"
					              [(ngModel)]="proposal.wantsBiomassDeuteration">Biomass
						<small>(yeast)</small>
					</mat-checkbox>
					<mat-checkbox name="proposal.wantsProteinDeuteration"
					              [(ngModel)]="proposal.wantsProteinDeuteration">Protein <em>
						<small>(E. coli)</small>
					</em>
					</mat-checkbox>
					<mat-checkbox name="proposal.wantsOtherDeuteration"
					              [(ngModel)]="proposal.wantsOtherDeuteration">Other
					</mat-checkbox>
					<mat-form-field *ngIf="proposal.wantsOtherDeuteration">
						<input matInput
						       name="proposal.biomassDeuteration.other"
						       [(ngModel)]="proposal.biomassDeuteration.other"
						       placeholder="Please explain:">
					</mat-form-field>
				</mat-card>
				<mat-card>

					<mat-expansion-panel [disabled]="!proposal.wantsBiomassDeuteration"
					                     [expanded]="proposal.wantsBiomassDeuteration">
						<mat-expansion-panel-header><h4>For biomass</h4></mat-expansion-panel-header>
						<mat-radio-group name="proposal.biomassDeuteration.organismProvidedByUser"
						                 [(ngModel)]="proposal.biomassDeuteration.organismProvidedByUser"
						                 [disabled]="!proposal.wantsBiomassDeuteration">
							<p> Will user provide the organism for us to grow under deuterated conditions?</p>
							<mat-radio-button value="yes">Yes</mat-radio-button>
							<mat-radio-button value="no">No</mat-radio-button>
						</mat-radio-group>
						<mat-form-field>
							<textarea matInput
							          name="proposal.biomassDeuteration.organismDetails"
							          [(ngModel)]="proposal.biomassDeuteration.organismDetails"
							          [disabled]="!proposal.wantsBiomassDeuteration"
							          placeholder="What is the organism?"
							          rows="4" cols="40"></textarea>
						</mat-form-field>
						<p>Please attach a reference or protocol of culture conditions and media composition<br>
							<strong style="color: red;">Accepted formats: PDF</strong></p>
						<label class="btn btn-default">
							<input name="organismReferenceAttachment"
							       style="width: 100%;"
							       type="file"
							       (change)="selectFile($event)">
						</label>
						<mat-form-field>
							<input matInput name="proposal.biomassDeuteration.amountNeeded"
							       [(ngModel)]="proposal.biomassDeuteration.amountNeeded"
							       [disabled]="!proposal.wantsBiomassDeuteration"
							       placeholder="How much material do you need?">
						</mat-form-field>
						<mat-form-field>
							<input matInput name="proposal.biomassDeuteration.stateOfMaterial"
							       [(ngModel)]="proposal.biomassDeuteration.stateOfMaterial"
							       [disabled]="!proposal.wantsBiomassDeuteration"
							       placeholder="Indicate wet or dry mass:">
						</mat-form-field>
						<mat-form-field>
							<textarea matInput
							          name="proposal.biomassDeuteration.amountOfMaterialMotivation"
							          [(ngModel)]="proposal.biomassDeuteration.amountOfMaterialMotivation"
							          [disabled]="!proposal.wantsBiomassDeuteration"
							          placeholder="Justify amount:"
							          rows="4" cols="40"></textarea>
						</mat-form-field>
						<mat-radio-group name="proposal.biomassDeuteration.deuterationLevelRequired"
						                 [(ngModel)]="proposal.biomassDeuteration.deuterationLevelRequired"
						                 [disabled]="!proposal.wantsBiomassDeuteration">
							<p> Level of deuteration required:</p>
							<mat-radio-button value="partial">Partial (65-80% with unlabeled carbon source)
							</mat-radio-button>
							<mat-radio-button value="full">Full (~99% with labeled carbon source)</mat-radio-button>
						</mat-radio-group>
						<mat-form-field>
							<textarea matInput name="proposal.biomassDeuteration.deuterationLevelMotivation"
							          [(ngModel)]="proposal.biomassDeuteration.deuterationLevelMotivation"
							          [disabled]="!proposal.wantsBiomassDeuteration"
							          placeholder="Justify level of D incorporation:"
							          rows="4" cols="40"></textarea>
						</mat-form-field>

						<mat-action-row>
							<button mat-raised-button color="primary" type="submit">Save</button>
						</mat-action-row>

					</mat-expansion-panel>
				</mat-card>

				<mat-card>
					<mat-expansion-panel [disabled]="!proposal.wantsProteinDeuteration"
					                     [expanded]="proposal.wantsProteinDeuteration">
						<mat-expansion-panel-header>
							<mat-panel-title><h4>For proteins</h4></mat-panel-title>
						</mat-expansion-panel-header>

						<mat-form-field>
							<p>Name of molecule to be deuterated: <br><em>
								<small>(e.g. superoxide dismutase)</small>
							</em></p>
							<input matInput
							       name="proposal.proteinDeuteration.moleculeName"
							       [(ngModel)]="proposal.proteinDeuteration.moleculeName">
						</mat-form-field>

						<mat-form-field>
							<p>FASTA sequence or Uniprot number:</p>
							<input matInput
							       name="proposal.proteinDeuteration.moleculeIdentifier"
							       [(ngModel)]="proposal.proteinDeuteration.moleculeIdentifier">
						</mat-form-field>

						<mat-form-field>
							<p>Molecular weight
								<small>(kDA)</small>
								:
							</p>
							<input matInput
							       name="proposal.proteinDeuteration.molecularWeight"
							       [(ngModel)]="proposal.proteinDeuteration.molecularWeight">
						</mat-form-field>

						<mat-form-field>
							<p>Oligomerization state:<br><em>
								<small>(e.g. homodimer, tetramer etc.)</small>
							</em></p>
							<input matInput
							       name="proposal.proteinDeuteration.oligomerizationState"
							       [(ngModel)]="proposal.proteinDeuteration.oligomerizationState">
						</mat-form-field>

						<mat-form-field>
							<p>Does the protein have any co-factors or ligands required for expression? Specify:</p>
							<textarea matInput
							          name="proposal.proteinDeuteration.expressionRequirements"
							          [(ngModel)]="proposal.proteinDeuteration.expressionRequirements"
							          rows="4" cols="40"></textarea>
						</mat-form-field>

						<mat-form-field>
							<p>Origin of molecules:<br><em>
								<small>(e.g. human, E. coli, S. cerevisiae)</small>
							</em></p>
							<input matInput
							       name="proposal.proteinDeuteration.moleculeOrigin"
							       [(ngModel)]="proposal.proteinDeuteration.moleculeOrigin">
						</mat-form-field>

						<mat-radio-group name="proposal.proteinDeuteration.expressionPlasmidProvidedByUser"
						                 [(ngModel)]="proposal.proteinDeuteration.expressionPlasmidProvidedByUser">
							<p>Will you provide an expression plasmid?</p>
							<mat-radio-button value="yes">Yes</mat-radio-button>
							<mat-radio-button value="no">No</mat-radio-button>
						</mat-radio-group>
						<mat-form-field *ngIf="proposal.proteinDeuteration.expressionPlasmidProvidedByUser === 'yes'">
							<p>Please provide details:<br><em>
								<small>(e.g. pET31b, C-terminal His-tag, Amp selection)</small>
							</em></p>
							<input matInput
							       name="proposal.proteinDeuteration.expressionPlasmidProvidedByUserDetails"
							       [(ngModel)]="proposal.proteinDeuteration.expressionPlasmidProvidedByUserDetails">
						</mat-form-field>
						<p *ngIf="proposal.proteinDeuteration.expressionPlasmidProvidedByUser === 'no'">
							If you chose no, we will design & order a plasmid commercially</p>
						<mat-form-field>
							<p>How much material do you need?</p>
							<input matInput
							       name="proposal.proteinDeuteration.amountNeeded"
							       [(ngModel)]="proposal.proteinDeuteration.amountNeeded">
						</mat-form-field>

						<mat-form-field>
							<p>Justify amount:</p>
							<input matInput
							       name="proposal.proteinDeuteration.deuterationLevelMotivation"
							       [(ngModel)]="proposal.proteinDeuteration.deuterationLevelMotivation">
						</mat-form-field>


						<mat-radio-group name="proposal.proteinDeuteration.deuterationLevelRequired"
						                 [(ngModel)]="proposal.proteinDeuteration.deuterationLevelRequired">
							<p>Level of deuteration required:</p>
							<mat-radio-button value="full">Full (~99% with labeled carbon source)</mat-radio-button>
							<mat-radio-button value="partial65">Partial (65-80% with unlabeled carbon source)</mat-radio-button>
							<mat-radio-button value="partial25">Partial (25-30% H/D exchange)</mat-radio-button>
						</mat-radio-group>

						<mat-form-field>
							<p>Justify level of D incorporation:</p>
							<input matInput
							       name="proposal.proteinDeuteration.deuterationLevelMotivation"
							       [(ngModel)]="proposal.proteinDeuteration.deuterationLevelMotivation">
						</mat-form-field>
						<mat-radio-group name="proposal.proteinDeuteration.needsPurificationSupport"
						                 [(ngModel)]="proposal.proteinDeuteration.needsPurificationSupport">
							<p>Will you need DEMAX to purify the protein from deuterated biomass?</p>
							<mat-radio-button value="yes">Yes</mat-radio-button>
							<mat-radio-button value="no">No</mat-radio-button>
						</mat-radio-group>

						<div *ngIf="proposal.proteinDeuteration.needsPurificationSupport === 'yes'">
							<p>If “yes”, please attach reference or protocol as PDF:<br><strong style="color: red;">Accepted formats: PDF</strong></p>
							<label class="btn btn-default">
								<input name="needsPurificationSupportAttachment"
								       style="width: 100%;"
								       type="file"
								       (change)="selectFile($event)">
							</label>
						</div>
						<mat-radio-group name="proposal.proteinDeuteration.hasDoneUnlabeledProteinExpression"
						                 [(ngModel)]="proposal.proteinDeuteration.hasDoneUnlabeledProteinExpression">
							<p>Has expression been done for the unlabeled protein?</p>
							<mat-radio-button value="yes">Yes</mat-radio-button>
							<mat-radio-button value="no">No</mat-radio-button>
						</mat-radio-group>
						<mat-radio-group name="proposal.proteinDeuteration.hasProteinPurificationExperience"
						                 [(ngModel)]="proposal.proteinDeuteration.hasProteinPurificationExperience">
							<p>Have you been able to purify the unlabeled protein? </p>
							<mat-radio-button value="yes">Yes</mat-radio-button>
							<mat-radio-button value="no">No</mat-radio-button>
						</mat-radio-group>
						<mat-radio-group name="proposal.proteinDeuteration.hasProteinDeuterationExperience"
						                 [(ngModel)]="proposal.proteinDeuteration.hasProteinDeuterationExperience">
							<p>Have you tried to deuterate the protein yourself, even in small scale?</p>
							<mat-radio-button value="yes">Yes</mat-radio-button>
							<mat-radio-button value="no">No</mat-radio-button>
						</mat-radio-group>

						<mat-form-field *ngIf="proposal.proteinDeuteration.hasProteinDeuterationExperience === 'yes'">
							<p>Results?</p>
							<input matInput
							       name="proposal.proteinDeuteration.proteinDeuterationResults"
							       [(ngModel)]="proposal.proteinDeuteration.proteinDeuterationResults">
						</mat-form-field>

					</mat-expansion-panel>
				</mat-card>

				<mat-card>
					<h4>Biosafety</h4>
					<mat-radio-group name="proposal.bioSafety.bioSafetyContainmentLevel"
					                 [(ngModel)]="proposal.bioSafety.bioSafetyContainmentLevel">
						<p>Which biosafety containment level is required to work with your sample?</p>
						<mat-radio-button value="L1">L1</mat-radio-button>
						<mat-radio-button value="L2">L2</mat-radio-button>
					</mat-radio-group>
					<mat-radio-group name="proposal.bioSafety.organismRisk"
					                 [(ngModel)]="proposal.bioSafety.organismRisk">
						<p>Is your organism a live virus, toxin-producing, or pose ay risk to human health and/or the
							environment?</p>
						<mat-radio-button value="yes">Yes</mat-radio-button>
						<mat-radio-button value="no">No</mat-radio-button>
					</mat-radio-group>
					<mat-form-field *ngIf="proposal.bioSafety.organismRisk == 'yes'">
						<p>If you chose “yes”, please provide details:</p>
						<input matInput
						       name="proposal.bioSafety.organismRiskDetails"
						       [(ngModel)]="proposal.bioSafety.organismRiskDetails">
					</mat-form-field>
					<mat-form-field>
						<p>If there is anything else you would like us to know, please enter it below:</p>
						<input matInput
						       name="proposal.bioSafety.other"
						       [(ngModel)]="proposal.bioSafety.other">
					</mat-form-field>
				</mat-card>

				<mat-action-row>
					<button mat-button class="btn btn-danger" (click)="selectTab(3)">Skip</button>
					<button mat-button class="btn btn-danger" (click)="selectTab(1)">Back</button>
					<button mat-button class="btn btn-primary" (click)="selectTab(3)">Next</button>
					<button mat-raised-button color="primary" type="submit">Save</button>
				</mat-action-row>

			</mat-tab>

			<mat-tab label="4. Chemical deuteration" [disabled]="!proposal.wantsChemicalDeuteration">
				<mat-card>
					<mat-form-field>
						<input matInput
						       name="proposal.chemicalDeuteration.moleculeName"
						       [(ngModel)]="proposal.chemicalDeuteration.moleculeName"
						       [disabled]="!proposal.wantsChemicalDeuteration"
						       placeholder="Molecule/s to be deuterated (name):">
					</mat-form-field>
					<mat-form-field>
						<input matInput
						       name="proposal.chemicalDeuteration.amount"
						       [(ngModel)]="proposal.chemicalDeuteration.amount"
						       [disabled]="!proposal.wantsChemicalDeuteration"
						       placeholder="Amount of material required (mass):">
					</mat-form-field>
					<mat-form-field>
					<textarea matInput
					          name="proposal.chemicalDeuteration.amountMotivation"
					          [(ngModel)]="proposal.chemicalDeuteration.amountMotivation"
					          [disabled]="!proposal.wantsChemicalDeuteration"
					          placeholder="Justify amount:"
					          rows="6" cols="40"></textarea>
					</mat-form-field>
					<mat-form-field>
						<input matInput
						       name="proposal.chemicalDeuteration.deuterationLocationAndPercentage"
						       [(ngModel)]="proposal.chemicalDeuteration.deuterationLocationAndPercentage"
						       [disabled]="!proposal.wantsChemicalDeuteration"
						       placeholder="Indicate percentage and location of deuteration:">
					</mat-form-field>
					<mat-form-field>
					<textarea matInput
					          name="proposal.chemicalDeuteration.deuterationLevelMotivation"
					          [(ngModel)]="proposal.chemicalDeuteration.deuterationLevelMotivation"
					          [disabled]="!proposal.wantsChemicalDeuteration"
					          placeholder="Justify level of deuteration"
					          rows="5" cols="40"></textarea>
					</mat-form-field>
						<p>Attach chemical structure:<br><strong style="color: red;">Accepted formats: PDF</strong></p>
						<label class="btn btn-default">
							<input name="chemicalStructureAttachment"
							       style="width: 100%;"
							       type="file"
							       (change)="selectFile($event)">
						</label>
					<mat-radio-group name="proposal.chemicalDeuteration.hasPreviousProductionExperience"
					                 [(ngModel)]="proposal.chemicalDeuteration.hasPreviousProductionExperience"
					                 [disabled]="!proposal.wantsChemicalDeuteration">
						<p>Has this molecule (or an unlabeled/isotopic analogue) been prepared by yourself or others?</p>
						<mat-radio-button value="yes">Yes</mat-radio-button>
						<mat-radio-button value="no">No</mat-radio-button>
					</mat-radio-group>

					<div *ngIf="proposal.chemicalDeuteration.hasPreviousProductionExperience === 'yes'">
						<p>Please provide a protocol:<br><strong style="color: red;">Accepted formats: PDF</strong></p>
						<label class="btn btn-default">
							<input name="chemicalStructureAttachment"
							       style="width: 100%;"
							       type="file"
							       (change)="selectFile($event)">
						</label>
					</div>

					<mat-action-row>
						<button mat-button class="btn btn-danger" (click)="selectTab(4)">Skip</button>
						<button mat-button class="btn btn-danger" (click)="selectTab(2)">Back</button>
						<button mat-button class="btn btn-primary" (click)="selectTab(4)">Next</button>
						<button mat-raised-button color="primary" type="submit">Save</button>
					</mat-action-row>
				</mat-card>
			</mat-tab>


			<mat-tab label="5. Upload proposal">
				<mat-card>

					<fieldset>
						<mat-label>Upload your deuteration proposal here</mat-label>
						<p><em>(Accepted formats: PDF)</em></p>
						<label class="btn btn-default">
							<input type="file" name="proposalTemplate" (change)="selectFile($event)">
						</label>
					</fieldset>

					<div *ngIf="currentFileUpload" class="progress">
						<div class="progress-bar progress-bar-info progress-bar-striped" role="progressbar"
						     attr.aria-valuenow="{{progress.percentage}}"
						     aria-valuemin="0" aria-valuemax="100" [ngStyle]="{width:progress.percentage+'%'}">
							{{progress.percentage}}%
						</div>
					</div>

					<button class="btn btn-success" [disabled]="!selectedFiles" (click)="upload()">Upload</button>
					<div>
						<tr *ngFor="let file of fileUploads | async" style="margin: 1rem;">
							<td><img src="../../../assets/logos/pdf.png" alt="{{file.name}}" width="80"></td>
							<td class="panel-body"><a href="http://localhost:8080/api/file/{{file}}">{{file}}</a></td>
							<td>
								<button style="padding: 0.5rem;" (click)="deleteFile(file, proposal)"
								        class="btn-danger">Delete
								</button>
							</td>
							<td><a style="padding: 0.5rem;" class="btn-success"
							       href="http://localhost:8080/api/file/{{file}}">Download</a></td>
						</tr>
					</div>
					<fieldset>
						<a mat-raised-button color="warn" (click)="generate()"
						   href="http://localhost:8080/api/pdf/{{proposal.proposalId}}">Generate Deuteration
							proposal</a>
					</fieldset>
					<fieldset>
						<a mat-raised-button color="warn" (click)="merge()" class="btn btn-danger"
						   href="http://localhost:8080/api/pdf/merge/{{proposal.proposalId}}">Merge attachments with
							proposal</a>
					</fieldset>
					<mat-action-row>
						<button mat-button (click)="selectTab(3)">Go back</button>
						<button mat-raised-button color="primary" type="submit">Submit</button>
					</mat-action-row>
				</mat-card>
			</mat-tab>

		</mat-tab-group>

	</form>

</section>