
<form [formGroup]="proposalForm">
	<mat-tab-group [(selectedIndex)]="selectedIndex">

		<mat-tab label="1. General information">
			<mat-card>

				<h3>
					Proposal ID: {{proposal.proposalId}}
				</h3>

				<mat-form-field>
					<input matInput
					       required
					       formControlName="experimentTitle"
					       placeholder="Experiment title">
				</mat-form-field>
				<mat-form-field>
					<textarea matInput
					          required
					          formControlName="briefSummary"
					          placeholder="Brief summary"
					rows="4" cols="40"></textarea>
				</mat-form-field>

				<h4>Main proposer</h4>

				<div formGroupName="mainProposer">
					<mat-form-field class="smallFormField">
						<input matInput
						       formControlName="firstName"
						       placeholder="First name">
					</mat-form-field>
					<mat-form-field class="smallFormField">
						<input matInput
						       formControlName="lastName"
						       placeholder="Last name">
					</mat-form-field>
					<br>
					<mat-form-field class="smallFormField">
						<input matInput
						       formControlName="email"
						       placeholder="Email">
					</mat-form-field>
					<mat-form-field class="smallFormField">
						<input matInput
						       formControlName="phone"
						       placeholder="Phone">
					</mat-form-field>

					<p>Affiliation</p>

					<div>
						<mat-form-field class="smallFormField">
							<input matInput
							       formControlName="jobTitle"
							       placeholder="Job title">
						</mat-form-field>
						<mat-form-field class="smallFormField">
							<input matInput
							       formControlName="employer"
							       placeholder="Employer">
						</mat-form-field>
						<mat-form-field>
							<input matInput
							       formControlName="industry"
							       placeholder="Industry">
						</mat-form-field>
					</div>
				</div>

				<table formArrayName="coProposers">
					<h4>Co-proposers</h4>
					<button mat-raised-button style="margin: 0;" class="btn btn-success" (click)="addCoProposer()"><mat-icon>add</mat-icon> Click to add</button>
					<tr *ngFor="let coProposer of coProposerForms.controls; let i=index" [formGroupName]="i">
						<td>
							<mat-form-field class="smallFormField">
								<input matInput formControlName="firstName" placeholder="First name">
							</mat-form-field>
						</td>
						<td>
							<mat-form-field class="smallFormField">
								<input matInput formControlName="lastName" placeholder="Last name">
							</mat-form-field>
						</td>
						<td>
							<mat-form-field class="smallFormField">
								<input matInput formControlName="affiliation" placeholder="Affiliation">
							</mat-form-field>
						</td>
						<td>
							<button mat-raised-button class="btn-danger" (click)="deleteCoProposer(i)"><mat-icon>delete</mat-icon></button>
						</td>
					</tr>
				</table>

				<mat-radio-group formControlName="linksWithIndustry">
					<p>Links with industry</p>
					<mat-radio-button value="yes">Yes</mat-radio-button>
					<mat-radio-button value="no">No</mat-radio-button>
				</mat-radio-group>
				<mat-radio-group formControlName="coProposerStudents">
					<p>Are any of the co-proposers students?</p>
					<mat-radio-button value="yes">Yes</mat-radio-button>
					<mat-radio-button value="no">No</mat-radio-button>
				</mat-radio-group>
				<mat-radio-group formControlName="workTowardsStudentsDegree">
					<p>Does the proposal work towards a students degree?</p>
					<mat-radio-button value="yes">Yes</mat-radio-button>
					<mat-radio-button value="no">No</mat-radio-button>
				</mat-radio-group>

				<h4>Final delivery date</h4>
				<mat-form-field>
					<input matInput
					       required
					       formControlName="needByDate"
					       [matDatepicker]="picker"
					       placeholder="Choose a final delivery date">
					<mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
					<mat-datepicker #picker></mat-datepicker>
				</mat-form-field>
				<mat-form-field>
					<p>Please motivate the chosen date<br><em>
						<small>(e.g. based on awarded beamtime, or described intention to apply)</small>
					</em></p>
					<textarea matInput
					          required
					          formControlName="needByDateMotivation"
					          rows="4" cols="40"></textarea>
				</mat-form-field>
				<p>Attach a copy of the beamtime proposal, draft or intended submission:<br><strong
						style="color: red;">Accepted formats: PDF</strong></p>
				<input type="file"
				       name="proposalTemplate"
				       id="needByDateAttachment"
				       class="inputfile btn btn-primary"
				       (change)="selectFile($event)">
				<label for="proposalTemplate">Choose a file</label>
				<mat-form-field>
					<p>If there is anything else you would like us to know, please enter it below:</p>
					<textarea matInput
					          formControlName="other"
					          rows="4" cols="40"></textarea>
				</mat-form-field>
				<p>In the next sections you will fill out the applicable area of support your proposal requires.<br>Select
					one, or as many as apply, from the alternatives below.</p>

				<mat-checkbox formControlName="wantsCrystallization">Crystallization</mat-checkbox>
				<mat-checkbox formControlName="wantsBiologicalDeuteration">Biological deuteration</mat-checkbox>
				<mat-checkbox formControlName="wantsChemicalDeuteration">Chemical deuteration</mat-checkbox>

				<mat-action-row>
					<button mat-button class="btn btn-danger" routerLink="/home">Cancel</button>
					<button mat-button class="btn btn-primary" (click)="selectTab(1)">Next</button>
					<button mat-raised-button color="primary" (click)="addProposal()">Save</button>
				</mat-action-row>
			</mat-card>
		</mat-tab>
		<mat-tab label="2. Crystallization">
			<mat-card>

				<div formGroupName="crystallization">
					<p>Required information to include in the “Practical Considerations” section of your proposal:</p>
					<ul>
						<li>SDS-PAGE</li>
						<li>Chromatogram of protein purification to indicate yield & purity</li>
						<li>Photo of crystal</li>
					</ul>

					<mat-form-field>
						<p><br><em>
						</em></p>
						<input matInput
						       formControlName="moleculeName"
						       placeholder="Name of molecule to be crystallized:">
						<mat-hint>(e.g. superoxide dismutase)</mat-hint>
					</mat-form-field>
					<mat-form-field>
						<input matInput
						       formControlName="moleculeIdentifier"
						       placeholder="FASTA sequence or Uniprot number:">
					</mat-form-field>
					<mat-form-field>
						<input matInput
						       formControlName="molecularWeight"
						       placeholder="Molecular weight:">
						<mat-hint>(kDA)</mat-hint>
					</mat-form-field>
					<mat-form-field>
						<input matInput
						       placeholder="Oligomerization state:"
						       formControlName="oligomerizationState">
						<mat-hint>(e.g. homodimer, tetramer etc.)</mat-hint>
					</mat-form-field>
					<mat-form-field>
						<input matInput placeholder="PDB ID of crystal structure:"
						       formControlName="pbdId">
					</mat-form-field>
					<mat-form-field>
						<p>If the reference is publicly available, please provide the DOI or an accessible link:</p>
						<input matInput
						       formControlName="doi">
					</mat-form-field>
					<p>If the reference isn't publicly available, please upload a copy:<br><strong style="color: red;">Accepted
						formats: PDF</strong></p>
					<label class="btn btn-default">
						<input name="pbdIdReferenceAttachment"
						       style="width: 100%;"
						       type="file">
					</label>
					<mat-form-field>
						<p>Does the protein have any co-factors or ligands required for crystallization? Specify:</p>
					<textarea rows="6" cols="40" matInput formControlName="crystallizationRequirements"></textarea>
					</mat-form-field>
					<mat-form-field>
						<p>Known crystallization precipitant composition</p>
					<textarea rows="6" cols="40" matInput
							formControlName="crystallizationPrecipitantComposition"></textarea>
						<mat-hint>(incl. buffer, salt, additives, pH)</mat-hint>
					</mat-form-field>
					<mat-form-field>
						<p>What crystallization method, volume, and temperature have you used in the past?
						<br><small>(e.g.vapour diffusion, 10 &#181;L drops, room temperature)</small></p>
					<textarea rows="8" cols="60" matInput formControlName="previousCrystallizationExperience"></textarea>
					</mat-form-field>
					<mat-form-field>
						<p>How long do your crystals take to appear?</p>
						<input matInput
						       formControlName="estimatedCrystallizationProductionTime">
					</mat-form-field>
					<mat-form-field>
						<p>What is the typical size of your crystal? (&#181;m x &#181;m x &#181;m)</p>
						<input matInput
						       formControlName="typicalCrystalSize">
					</mat-form-field>

					<br>

					<h4>Details from protein preparation</h4>
					<mat-form-field>
						<p>Typical yield<br><small>(mg per liter of culture)</small></p>
						<input matInput
						       required
						       formControlName="typicalYieldMgPerLiter">
					</mat-form-field>
					<mat-form-field>
						<p>Storage conditions:<br><small>(e.g. stable at 4 &#176;C or frozen at -20 &#176;C)</small></p>
						<input matInput
						       required
						       formControlName="storageConditions">
					</mat-form-field>
					<mat-form-field>
						<p>Stability:</p>
						<input matInput formControlName="stability">
					</mat-form-field>
					<mat-form-field>
						<p>What buffer is your protein in?</p>
						<input matInput
						       required
						       formControlName="buffer">
					</mat-form-field>
					<mat-form-field>
						<p>Is your protein partially or fully deuterated?</p>
						<input matInput
						       required
						       formControlName="levelOfDeuteration">
					</mat-form-field>
					<mat-form-field>
						<p>What protein concentration do you usually use for crystallization?</p>
						<input matInput
						       formControlName="typicalProteinConcentrationUsed">
					</mat-form-field>
					<mat-action-row>
						<button mat-button class="btn btn-danger" (click)="selectTab(2)">Skip</button>
						<button mat-button class="btn btn-danger" (click)="selectTab(0)">Back</button>
						<button mat-button class="btn btn-primary" (click)="selectTab(2)">Next</button>
						<button mat-raised-button color="primary" (click)="addProposal()">Save</button>
					</mat-action-row>
				</div>
			</mat-card>
		</mat-tab>
		<mat-tab label="3. Biological deuteration">

		</mat-tab>
		<mat-tab label="4. Chemical deuteration" formGroupName="chemicalDeuteration">
			<mat-card>
				<mat-form-field>
					<input matInput
					       formControlName="moleculeName"
					       placeholder="Molecule/s to be deuterated (name):">
				</mat-form-field>
				<mat-form-field>
					<input matInput
					       formControlName="amount"
					       placeholder="Amount of material required (mass):">
				</mat-form-field>
				<mat-form-field>
					<textarea matInput
					          formControlName="amountMotivation"
					          placeholder="Justify amount:"
					          rows="6" cols="40"></textarea>
				</mat-form-field>
				<mat-form-field>
					<input matInput
					       formControlName="deuterationLocationAndPercentage"
					       placeholder="Indicate percentage and location of deuteration:">
				</mat-form-field>
				<mat-form-field>
					<textarea matInput
					          formControlName="deuterationLevelMotivation"
					          placeholder="Justify level of deuteration"
					          rows="5" cols="40"></textarea>
				</mat-form-field>
				<p>Attach chemical structure:<br><strong style="color: red;">Accepted formats: PDF</strong></p>
				<label class="btn btn-default">
					<input name="chemicalStructureAttachment"
					       style="width: 100%;"
					       type="file"
					       (change)="selectFile($event)">
				</label>
				<mat-radio-group formControlName="hasPreviousProductionExperience">
					<p>Has this molecule (or an unlabeled/isotopic analogue) been prepared by yourself or
						others?</p>
					<mat-radio-button value="yes">Yes</mat-radio-button>
					<mat-radio-button value="no">No</mat-radio-button>
				</mat-radio-group>

				<mat-card class="fileUpload"
				          *ngIf="hasPreviousProductionExperience === 'yes'">
					<p>Please provide a protocol:<br><strong style="color: red;">Accepted formats: PDF</strong></p>
					<label class="btn btn-default">
						<input name="chemicalStructureAttachment"
						       style="width: 100%;"
						       type="file"
						       (change)="selectFile($event)">
					</label>
				</mat-card>

				<mat-action-row>
					<button mat-button class="btn btn-danger" (click)="selectTab(4)">Skip</button>
					<button mat-button class="btn btn-danger" (click)="selectTab(2)">Back</button>
					<button mat-button class="btn btn-primary" (click)="selectTab(4)">Next</button>
					<button mat-raised-button color="primary" type="submit">Save</button>
				</mat-action-row>
			</mat-card>
		</mat-tab>

		<mat-tab label="5. Review and submit">
			<mat-card>
				<mat-card>
					<h4>Upload deuteration proposal</h4>
					<p>
						<small><em>The proposal should be 2 pages max, including
							figures & tables & references – please pay attention to requirements for uploading
							references and images during proposal submission process.
							For more detailed instructions, see the <a routerLink="/guidelines">proposal
								guidelines</a>.</em>
						</small>
					</p>
					<input type="file"
					       name="proposalTemplate"
					       id="proposalTemplate"
					       class="inputfile btn btn-primary"
					       (change)="selectFile($event)">
					<label for="proposalTemplate">Choose a file</label>

				</mat-card>

				<mat-card>
					<h4>Merge and download all files as pdf</h4>
					<p>Click to merge and download all your attachments into a single PDF document.</p>
					<a download
					   mat-raised-button
					   color="warn"
					   href="{{url}}/api/pdf/merge/{{proposal.proposalId}}">
						<mat-icon>picture_as_pdf</mat-icon>
						Download
					</a>
					<br>
					<button mat-raised-button color="primary" type="submit">Submit</button>
				</mat-card>
				<mat-action-row>
					<button mat-button (click)="selectTab(3)">Go back</button>
				</mat-action-row>

			</mat-card>
		</mat-tab>
	</mat-tab-group>
</form>
